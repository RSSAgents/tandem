name: PR Notification

on:
  pull_request_target:
    types: [opened, reopened, ready_for_review]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: github.event.pull_request.draft == false
    
    steps:
      - name: Send Telegram Notification
        run: |
          if [ "${{ github.event.action }}" == "opened" ]; then
            EVENT="ğŸ†• ĞĞ¾Ğ²Ñ‹Ğ¹ PR"
          elif [ "${{ github.event.action }}" == "reopened" ]; then
            EVENT="ğŸ”„ PR Ğ¿ĞµÑ€ĞµĞ¾Ñ‚ĞºÑ€Ñ‹Ñ‚"
          else
            EVENT="ğŸ“ PR Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€ĞµĞ²ÑŒÑ"
          fi
          
          REVIEWERS='${{ join(github.event.pull_request.requested_reviewers.*.login, ', ') }}'
          if [ -z "$REVIEWERS" ]; then
            REVIEWERS="Ğ½Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ñ‹"
          fi
          
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "${{ secrets.TELEGRAM_CHAT_ID }}",
              "text": "'"${EVENT}"'\n\nğŸ“ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ: ${{ github.event.pull_request.title }}\nğŸ‘¤ ĞĞ²Ñ‚Ğ¾Ñ€: ${{ github.event.pull_request.user.login }}\nğŸ‘¥ Ğ ĞµĞ²ÑŒÑĞµÑ€Ñ‹: '"${REVIEWERS}"'\nğŸŒ¿ Ğ’ĞµÑ‚ĞºĞ°: ${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}\nğŸ“Š Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ: +${{ github.event.pull_request.additions }} / -${{ github.event.pull_request.deletions }} | Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: ${{ github.event.pull_request.changed_files }}\n\nğŸ”— Ğ¡ÑÑ‹Ğ»ĞºĞ°: ${{ github.event.pull_request.html_url }}",
              "message_thread_id": ${{ secrets.TELEGRAM_THREAD_ID }},
              "disable_web_page_preview": true
            }'
